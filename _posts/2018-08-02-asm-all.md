---
layout: post
title:  "汇编语言的所有指令及使用详解"
categories: collection
tags:  asm
---

# 汇编语言的所有指令及使用详解

## 1、数据传送指令集

    MOV
    功能: 把源操作数送给目的操作数
    语法: MOV 目的操作数,源操作数
    格式: MOV r1,r2
    MOV r,m
    MOV m,r
    MOV r,data

    XCHG
    功能: 交换两个操作数的数据
    语法: XCHG
    格式: XCHG r1,r2 XCHG m,r XCHG r,m

    PUSH,POP
    功能: 把操作数压入或取出堆栈
    语法: PUSH 操作数 POP 操作数
    格式: PUSH r PUSH M PUSH data POP r POP m

    PUSHF,POPF,PUSHA,POPA
    功能: 堆栈指令群
    格式: PUSHF POPF PUSHA POPA

    LEA,LDS,LES
    功能: 取地址至寄存器
    语法: LEA r,m LDS r,m LES r,m

    XLAT(XLATB)
    功能: 查表指令
    语法: XLAT XLAT m

## 2、算数运算指令

    ADD,ADC
    功能: 加法指令
    语法: ADD OP1,OP2 ADC OP1,OP2
    格式: ADD r1,r2 ADD r,m ADD m,r ADD r,data
    影响标志: C,P,A,Z,S,O

    SUB,SBB
    功能:减法指令
    语法: SUB OP1,OP2 SBB OP1,OP2
    格式: SUB r1,r2 SUB r,m SUB m,r SUB r,data SUB m,data
    影响标志: C,P,A,Z,S,O

    INC,DEC
    功能: 把OP的值加一或减一
    语法: INC OP DEC OP
    格式: INC r/m DEC r/m
    影响标志: P,A,Z,S,O

    NEG
    功能: 将OP的符号反相(取二进制补码)
    语法: NEG OP
    格式: NEG r/m
    影响标志: C,P,A,Z,S,O

    MUL,IMUL
    功能: 乘法指令
    语法: MUL OP IMUL OP
    格式: MUL r/m IMUL r/m
    影响标志: C,P,A,Z,S,O(仅IMUL会影响S标志)

    DIV,IDIV
    功能:除法指令
    语法: DIV OP IDIV OP
    格式: DIV r/m IDIV r/m

    CBW,CWD
    功能: 有符号数扩展指令
    语法: CBW CWD

    AAA,AAS,AAM,AAD
    功能: 非压BCD码运算调整指令
    语法: AAA AAS AAM AAD
    影响标志: A,C(AAA,AAS) S,Z,P(AAM,AAD)

    DAA,DAS
    功能: 压缩BCD码调整指令
    语法: DAA DAS
    影响标志: C,P,A,Z,S

## 3、位运算指令集

    AND,OR,XOR,NOT,TEST
    功能: 执行BIT与BIT之间的逻辑运算
    语法: AND r/m,r/m/data OR r/m,r/m/data XOR r/m,r/m/data TEST r/m,r/m/data NOT r/m
    影响标志: C,O,P,Z,S(其中C与O两个标志会被设为0) NOT指令不影响任何标志位

    SHR,SHL,SAR,SAL
    功能: 移位指令
    语法: SHR r/m,data/CL SHL r/m,data/CL SAR r/m,data/CL SAL r/m,data/CL
    影响标志: C,P,Z,S,O

    ROR,ROL,RCR,RCL
    功能: 循环移位指令
    语法: ROR r/m,data/CL ROL r/m,data/CL RCR r/m,data/CL RCL r/m,data/CL
    影响标志: C,P,Z,S,O

## 程序流程控制指令集

    CLC,STC,CMC
    功能: 设定进位标志
    语法: CLC STC CMC
    标志位: C

    CLD,STD
    功能: 设定方向标志
    语法: CLD STD
    标志位: D

    CLI,STI
    功能: 设定中断标志
    语法: CLI STI
    标志位: I

    CMP
    功能: 比较OP1与OP2的值
    语法: CMP r/m,r/m/data
    标志位: C,P,A,Z,O

    JMP
    功能: 跳往指定地址执行
    语法: JMP 地址

    JXX
    功能: 当特定条件成立则跳往指定地址执行
    语法: JXX 地址
    注:
    A: ABOVE,当C=0,Z=0时成立
    B: BELOW,当C=1时成立
    C: CARRY,当弁时成立 CXZ: CX寄存器的值为0(ZERO)时成立
    E: EQUAL,当Z=1时成立
    G: GREATER(大于),当Z=0且S=0时成立
    L: LESS(小于),当S不为零时成立
    N: NOT(相反条件),需和其它符号配合使用
    O: OVERFLOW,O=1时成立
    P: PARITY,P=1时成立
    PE: PARITY EVEN,P=1时成立
    PO: PARITY ODD,P=0时成立
    S: SIGN,S=1时成立
    Z: ZERO,Z=1时成立

    LOOP
    功能: 循环指令集
    语法: LOOP 地址

    LOOPE(Z)
    地址 LOOPNE(Z) 地址
    标志位: 无

    CALL,RET
    功能: 子程序调用,返回指令
    语法: CALL 地址 RET RET n
    标志位: 无

    INT,IRET
    功能: 中断调用及返回指令
    语法: INT n IRET
    标志位: 在执行INT时,CPU会自动将标志寄存器的值入栈,在执行IRET时则会将堆栈中的标志值弹回寄存器

## 字符串操作指令集

    MOVSB,MOVSW,MOVSD
    功能: 字符串传送指令
    语法: MOVSB MOVSW MOVSD
    标志位: 无

    CMPSB,CMPSW,CMPSD
    功能: 字符串比较指令
    语法: CMPSB CMPSW CMPSD
    标志位: C,P,Z,S,O

    SCASB,SCASW
    功能: 字符串搜索指令
    语法: SCASB SCASW
    标志位: C,P,Z,S,O

    LODSB,LODSW,STOSB,STOSW
    功能: 字符串载入或存贮指令
    语法: LODSB LODSW STOSB STOSW
    标志位: 无

    REP,REPE,REPNE
    功能: 重复前缀指令集
    语法: REP 指令S REPE 指令S REPNE 指令S
    标志位: 依指令S而定

## IBM PC指令系统

对于IBM PC机它有它的指令系统，其中包括：数据传送指令、串处理指令、算术指令、控制移动指令、逻辑指令、处理机控制指令。

### 1)数据传送指令：

    负责把数据、地址或立即数传送到寄存器或存储单元中。
    数据传送指令类型 指 令 说 明
    通用数据传送指令 MOV（传送）、PUSH（进栈）、POP（出栈）、XCHG（交换）
    累加器专用传送指令 IN（输入指令） 、OUT（输入指令）
    地址传送指令 LEA（有效地址送寄存器）、LDS（指针送寄存器和DS）、LES（指针送寄存器和ES）
    标志寄存器传送指令 LAHF（标志送AH）、SAHF（AH送标志寄存器）、PUSHF（标志进栈）、POPF（标志出栈）

### 2）算术指令：

    用来执行算术运算。
    算术指令类型 指 令 说 明
    加法指令 ADD（加法）、ADC（带进位加法）、INC（加1）
    减法指令 SUB（减法）、SBB（带借位减法）、DEC（减1）、NEG（求补）、CMP（比较）
    乘法指令 MUL（无符号数乘法）、IMUL（带符号数乘法）
    除法指令 DIV（无符号数除法）、IDIV（带符号数除法）、CBW（字节转换为字）、CWD（字转换为双字）

### 3）逻辑指令：

    对字或字节执行逻辑运算。
    逻辑指令类型 指 令 说 明
    逻辑运算指令 AND（逻辑与）、OR（逻辑或）、NOT（逻辑非）、XOR（异或）、TEST（测试）
    移动指令 SHL（逻辑左移）、SAL（算术左移）、SHR（逻辑右移）、SAR（算术右移）、ROL（循环左移）、ROR（循环右移）、RCL（带进位循环左移）、RCR（带进位右移）

### 4）串处理指令：

    处理存放存储器里的数据串。
    串处理指令类型 指 令 说 明
    指 令 MOVS（串传送）、CMPS（串比较）、SCAS（串扫描）、LODS（从串取）、STOS（存入串）

### 5）控制转移指令：

用来控制程序的执行流程。
控制转移指令类型 指 令 说 明
无条件转移指令 JMP（段间和段内转移）
条件转移指令 JZ（结果为0（或相等）则转移）、JS（结果为负则转移）、JNS（结果为正则转移）、JO（溢出则转移）、JNO（不溢出则转移）、JP（奇偶位为1则转移）、JNP（奇偶位为0则转移）
循环指令 LOOP（循环指令）、LOOPPZ/LOOPE（当为0或相等时循环指令）、LOOPNZ/LOOPNE（当不为0或不相等时循环指令）
子程序指令 CALL（调用指令）、RET（返回指令）
中断指令 INT（中断）、INTO（如溢出则中断）、RIET（从中断返回）

### 6）处理机控制指令：

    处理机控制指令类型 指 令 说 明
    标志处理指令 CLC（进位位置0指令）、CMC（进位位求反指令）、STC（进位位置为1指令）、CLD（方向标志置1指令）、STD（方向标志位置1指令）、CLI（中断标志置0指令）、STI（中断标志置1指令）
    其他处理机控制指令 NOP（无操作）、HLT（停机）、WAIT（等待）、ESC（换码）、LOCK（封锁）

## 汇编语言程序格式

汇编语言源程序用语句书写，MASM中可使用的语句分成两类，他们是指令性语句和伪指令语句

### 1．指令性语句

指令性语句与机器指令相对应，汇编程序将他翻译成目标代码（机器指令代码）。语句格为：

    标号： 指令助记符 操作数，操作数；注释

    标号表示指令语句的符号地址，标号后面必须紧跟“：”。标号可以省略，他经常作为转移指令或CALL指令的一个操作数，用以表示地址的转移。
    指令助记符是该语句的指令名称的代表号码，他指出操作的类型，汇编程序将其翻译成机器指令。不可省略。
    操作数表示参加本指令的运算数据，根据指令的操作类型，操作数不同，中间必须用“，”隔开。
    注释指明一条指令的功能，可以省略。

### 2．伪指令语句

伪指令语句没有对应的机器指令。汇编程序汇编源程序时对伪指令进行处理，他可以完成数据定义，存储区分配，段定义，段分配，指示程序结束功能。伪指令语句的格式为：

    名字 伪指令指示符 操作数，操作数；注释

    名字时给伪指令取得名称，他用符号地址表示。伪指令中的名字通常是变量名，段名，过程名、符号名等。
    伪指令指示符是汇编程序MASM规定的符号。
    操作数是根据伪指令的具体要求来得。

### 3．数据项

汇编语言中使用的操作数，可以是常数、寄存器、存储器、变量、标号活表达式，其中藏书、变量和标号是三种基本数据项。

    ⑴常数必须是固定的值，没有属性，是确定的数据。
    ⑵变量在程序运行中是可以修改的。所有的变量具有三种属性
    ①段值（SEGMENT）：指明变量所在段的基址。
    ②段内偏移地址（OFFSET）：指变量所在地址与段首地址之间的偏移字节数。
    ③类型（TYPE）：变量的类型属性指变量中每个单元所包含的字节数，类型有：字节变量（BYTE）、字变量（WORD）、双字变量（DOUBLE WORD）
    ⑶标号：标号是指可执行指令语句的地址的符号表示，他可作为转移指令和调用指令的目标操作数，以确定程序转换的目标地址，他具有三个属性。
    ①段值（SEGMENT）：指明标号所在段的基址。
    ②段内偏移地址（OFFSET）：指标号所在地址与所在段段首地址之间的偏移字节数。
    ③类型（TYPE）：标号的类型属性指在转移指令中标号可转移的距离类型.NEAR，表示近标号只能实现在本代码段内转移或调用；FAR，表示远标号，可；以作为其他代码段中的目标地址，实现段间调用或转移。

## 伪指令汇总

### 1．数据定义语句

    格式一：变量名 助记符 操作数，操作数…；注释
    格式二：变量名 助记符 n DUP(操作数，操作数…)；注释
    功能：将操作数存入变量名指定的存储单元中，或者只分配存储空间不存入数据。
    变量名，用符号表示，可以省略。汇编程序时将此变量的助记符后的第一个字节的偏移地址作为他的符号地址。
    助记符主要有：
    DB：用来定义字节，表示每个操作数占用一个字节；
    DW：用来定义字，表示每个操作数占用一个字；
    DD：用来定义双字，表示每个操作数占用两个字；
    DQ：用来定义四个字，表示每个操作数占用四个字；
    DT：用来定义十个字节，表示每个操作数占用十个字节；
    在格式二中，用n DUP表示时，n必须是整数，表示括号中的操作数的重复次数。DUP后面必须带括号。

### 2．表达式赋值语句

    ⑴赋值语句EQU
    格式：符号名 EQU 表达式
    功能：用来给变量、标号、常数、指令、表达式等定义一个符号名，程序中用到EQU左边得变量、标号时可以用右边的常数值或表达式来代替，但是一经定义在同一个程序模块中不能再重新定义。
    ⑵符号语句＝
    符号语句“＝”与EQU语句具有相同功能，区别仅在于EQU中左边的标号不允许重新定义，而用“＝”定义的语句可以重新定义。
    3段定义语句
    存储器的物理地址由段基址和偏移地址组合而成，任何一个逻辑段，无论是数码段，数据段，堆栈段，附加段都必须定义。以便连接程序把不同段和模块连成一个可执行的程序。
    ⑴段定义语句SEGMENT…ENDS
    格式：段名 SEGMENT 定位类型 组合类型 ‘分类名’
    逻辑段内容
    段名 ENDS
    功能：将一个逻辑段定义成一个整体
    段名，是逻辑段的标识符，不能省略。他确定了逻辑段在存储器中的地址。必须以SEGMENT开始，以ENDS结束，前后段名必须一致。
    定位类型，定位类型参数是对该段起始地址的定位。定位类型参数主要有下面4种：
    ①PARA：指定定位段的起始地址必须在节的整数边界，当定位类型缺省时，就当成PARA
    ②BYTE：指定定位段的起始地址定位在存储单元的任何字节地址。
    ③WORD：指定定位段的起始地址定位在字的边界，即段的首地址必须是偶数。
    ④PAGE：指定定位段的起始地址定位在页的边界，即段的首地址必须是256的整数倍。
    组合类型：组合类型参数主要提供了各个逻辑段之间的组合方式
    ①NONE：该段与其他同名段不进行连接，各段独立于存储器中，NONE可作为缺省参数。
    ②PUBLIC：该段与其他模块中的同名段连接时，由低地址到高地址连接起来，组成一个逻辑段，连接次序由连接命令指定。
    ③COMMON：该段在连接时与其他模块中的同名段有相同的起始地址，采用覆盖的方式在存储器中存放，连接长度为各分段中最大长度。
    ④AT表达式：定位该段的起始地址在表达式所指定的节（16的整数倍）边界上。当用户要求某个逻辑段在指定节的边界上时，就要用AT参数来实现。
    ⑤STACK：指定该段为堆栈段，此参数在堆栈段中不可省略。
    ⑥MEMORY：定位该段与其他模块中的同名段有相同的首地址，采用覆盖的方法在存储器中组合连接。其功能与COMMON相似，区别是第一个带MEMORY参数的逻辑段覆盖在其他同名段的最上层，其他带此参数的同名段按照COMMON方式处理。
    ⑶“分类名”（CLASS NAME）
    其主要作用是汇编程序连接时将所有的分类名相同的逻辑段组成一个段组。

### 3．段分配语句（ASSUME）

    格式：ASSUME CS:段名，DS:段名，SS:段名，ES:段名
    功能：定义4个逻辑段，指明段和寄存器的关系。

### 4．过程定义语句

    格式：过程名 PROC 属性
    过程内容
    RET N
    过程名 ENDP
    功能：定义一个过程，主程序可以用CALL 指令调用他
    过程名：给所定义的过程取得名字，不可省略。象标号一样具有三个属性：段属性、偏移地址属性和距离属性。
    RET N为过程内部的返回指令。过程中至少一条RET，可以在任何位置，使过程返回到主程序调用他的CALL指令之下的一条指令。N为弹出值，可以缺省，表示从程返回以后，堆栈中应有N个字节的值作废。

### 5．程序开始和结束语句

    ⑴NAME:
    格式：NAME 程序名
    功能：为源程序目标模块赋名字。
    ⑵TITLE
    格式：TITLE 文本名
    功能：将文本名赋给源程序目标模块作名字，功能同NAM..
    ⑶ORG
    格式：ORG 表达式
    功能：给汇编程序设置位置指针，指定下面语句的起始偏移地址。
    ⑷END
    格式：END 标号名
    功能：标记汇编源程序结束

### 6．外部伪指令及对准伪指令

    程序中包含多个模块时，有些程序或数据在各个模块间要相互共享，可用外部伪指令PUBLIC和EXTRN来实现此功能。
    ⑴外部伪指令
    PUBLIC用来定义共享模块，EXTAN用来调用共享模块
    格式：PUBLIC 名称，名称，…
    EXTRN 名称：类型，名称：类型…
    ⑵对准伪指令
    格式：EVEN
    功能：EVEN伪指令使下一语句的地址调整为偶地址
    ⑶LABEL
    LABEL伪指令给已定义的变量或标号取另一个名字，并可重新定义他的类属性
    格式：名称 LABEL 类型属性